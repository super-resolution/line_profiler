{"parents": [], "prev": {"link": "../", "title": "Welcome to line profiler\u2019s documentation!"}, "next": {"link": "../controllers.fitter/", "title": "Fitter package"}, "title": "Utility package", "meta": {}, "body": "<div class=\"section\" id=\"module-controllers.utility\">\n<span id=\"utility-package\"></span><h1>Utility package<a class=\"headerlink\" href=\"#module-controllers.utility\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<dl class=\"docutils\">\n<dt>Utility package for image processing featuring funtcions like:</dt>\n<dd><ul class=\"first last simple\">\n<li>Create gradient images</li>\n<li>Compute the orientation and position line resembling patterns in an image.</li>\n<li>Fit functions to a one dimensional dataset and save the plot in a given path</li>\n</ul>\n</dd>\n</dl>\n<dl class=\"function\">\n<dt id=\"controllers.utility.compute_line_orientation\">\n<code class=\"descclassname\">controllers.utility.</code><code class=\"descname\">compute_line_orientation</code><span class=\"sig-paren\">(</span><em>image</em>, <em>blur</em>, <em>min_len=100</em>, <em>spline=3</em>, <em>expansion=1</em>, <em>expansion2=1</em><span class=\"sig-paren\">)</span><a class=\"reference internal\" href=\"../_modules/controllers/utility/#compute_line_orientation\"><span class=\"viewcode-link\">[source]</span></a><a class=\"headerlink\" href=\"#controllers.utility.compute_line_orientation\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Compute the orientation and position of line resembling patterns in an image.</p>\n<p>The image is convolved with a gaussian blur compensating for noise discontinuity or holes.\nA thresholding algorithm (1) converts the image from grayscale to binary. Using Lees algorithm (2)\nthe expanded lines are reduced to one pixel width. The pixel coordinates from all still connected lines\nare retrieved and tested for continuity. Points of discontinuity are used as breakpoints and all following\ncoordinates connected to a new line. Lines, shorter than the minimum required length are discarted.\nAn univariate spline of degree 3 is fitted to each line. Note that shape and gradient of the line depend on the\nsmoothing parameter. The rounded coordinates and their derivatives are returned in a table,\ntogether with the length of each line.</p>\n<table class=\"docutils field-list\" frame=\"void\" rules=\"none\">\n<col class=\"field-name\" />\n<col class=\"field-body\" />\n<tbody valign=\"top\">\n<tr class=\"field-odd field\"><th class=\"field-name\">Parameters:</th><td class=\"field-body\"><ul class=\"first simple\">\n<li><strong>image</strong> (<em>ndarray</em>) \u2013 Image containing line resembling patterns</li>\n<li><strong>blur</strong> (<em>int</em>) \u2013 Amount of blur to apply to the image. Should be in the order of magnitude of the line width in pixel.</li>\n<li><strong>min_len</strong> (<em>int</em>) \u2013 Minimal accepted line length</li>\n<li><strong>smooth</strong> (<em>float</em>) \u2013 Positive smoothing factor used to choose the number of knots</li>\n<li><strong>spline</strong> (<em>int</em>) \u2013 Degree of the smoothing spline. Must be &lt;= 5. Default is 3, a cubic spline.</li>\n</ul>\n</td>\n</tr>\n<tr class=\"field-even field\"><th class=\"field-name\">Returns:</th><td class=\"field-body\"><p class=\"first last\"><ul class=\"simple\">\n<li><strong>gradient_fitted_table</strong> (<em>ndarray</em>) \u2013 X, Y position of the splines. X, Y values of the spline gradient.</li>\n<li><strong>shapes</strong> (<em>ndarray</em>) \u2013 Lengths of the lines written in gradient_fitted_table.</li>\n</ul>\n</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p class=\"rubric\">References</p>\n<p>(1)  Nobuyuki Otsu: A threshold selection method from grey level histograms.\nIn: IEEE Transactions on Systems, Man, and Cybernetics. New York, 9.1979, S. 62\u201366. ISSN 1083-4419</p>\n<p>(2)  T.-C. Lee, R.L. Kashyap and C.-N. Chu,\nBuilding skeleton models via 3-D medial surface/axis thinning algorithms.\nComputer Vision, Graphics, and Image Processing, 56(6):462-478, 1994.</p>\n<p class=\"rubric\">Example</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"kn\">import</span> <span class=\"nn\">matplotlib.pyplot</span> <span class=\"k\">as</span> <span class=\"nn\">plt</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"kn\">from</span> <span class=\"nn\">src.controllers.utility</span> <span class=\"k\">import</span> <span class=\"o\">*</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"kn\">import</span> <span class=\"nn\">tifffile</span> <span class=\"k\">as</span> <span class=\"nn\">tif</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n<span class=\"go\">&gt;&gt;&gt;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">with</span> <span class=\"n\">tif</span><span class=\"o\">.</span><span class=\"n\">TiffFile</span><span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span><span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">getcwd</span><span class=\"p\">())</span> <span class=\"o\">+</span> <span class=\"sa\">r</span><span class=\"s2\">&quot;     est_data_microtub\\Expansion dSTORM-Line Profile test.tif&quot;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">file</span><span class=\"p\">:</span>\n<span class=\"gp\">&gt;&gt;&gt; </span>    <span class=\"n\">image</span> <span class=\"o\">=</span> <span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">asarray</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">astype</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">uint8</span><span class=\"p\">)</span><span class=\"o\">*</span><span class=\"mi\">40</span>\n<span class=\"go\">&gt;&gt;&gt;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">fig</span><span class=\"p\">,</span> <span class=\"n\">axs</span> <span class=\"o\">=</span> <span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">subplots</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">figsize</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">9</span><span class=\"p\">,</span> <span class=\"mi\">6</span><span class=\"p\">),</span> <span class=\"n\">sharey</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">axs</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">imshow</span><span class=\"p\">(</span><span class=\"n\">image</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">axs</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">set_xlabel</span><span class=\"p\">(</span><span class=\"s2\">&quot;test_image&quot;</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">axs</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">imshow</span><span class=\"p\">(</span><span class=\"n\">image</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">axs</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">set_xlabel</span><span class=\"p\">(</span><span class=\"s2\">&quot;test_image with fitted splines&quot;</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">spline_table</span><span class=\"p\">,</span> <span class=\"n\">shapes</span> <span class=\"o\">=</span> <span class=\"n\">compute_line_orientation</span><span class=\"p\">(</span><span class=\"n\">image</span><span class=\"p\">,</span> <span class=\"mi\">20</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">spline_positions</span> <span class=\"o\">=</span> <span class=\"n\">spline_table</span><span class=\"p\">[:,</span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"mi\">2</span><span class=\"p\">]</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">shapes</span><span class=\"p\">)):</span>\n<span class=\"gp\">&gt;&gt;&gt; </span>    <span class=\"n\">axs</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">plot</span><span class=\"p\">(</span><span class=\"n\">spline_positions</span><span class=\"p\">[</span><span class=\"n\">index</span><span class=\"p\">:</span><span class=\"n\">index</span><span class=\"o\">+</span><span class=\"n\">shapes</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">],</span><span class=\"mi\">1</span><span class=\"p\">],</span><span class=\"n\">spline_positions</span><span class=\"p\">[</span><span class=\"n\">index</span><span class=\"p\">:</span><span class=\"n\">index</span><span class=\"o\">+</span><span class=\"n\">shapes</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">],</span><span class=\"mi\">0</span><span class=\"p\">],</span> <span class=\"n\">c</span><span class=\"o\">=</span><span class=\"s2\">&quot;r&quot;</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span>    <span class=\"n\">index</span> <span class=\"o\">+=</span> <span class=\"n\">shapes</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<div class=\"figure\">\n<img alt=\"../_images/spline_fitting.png\" src=\"../_images/spline_fitting.png\" />\n</div>\n</dd></dl>\n\n<dl class=\"function\">\n<dt id=\"controllers.utility.create_gradient_image\">\n<code class=\"descclassname\">controllers.utility.</code><code class=\"descname\">create_gradient_image</code><span class=\"sig-paren\">(</span><em>image</em>, <em>blur</em>, <em>sobel=9</em><span class=\"sig-paren\">)</span><a class=\"reference internal\" href=\"../_modules/controllers/utility/#create_gradient_image\"><span class=\"viewcode-link\">[source]</span></a><a class=\"headerlink\" href=\"#controllers.utility.create_gradient_image\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Compute the Orientation of each pixel of a given image in rad</p>\n<table class=\"docutils field-list\" frame=\"void\" rules=\"none\">\n<col class=\"field-name\" />\n<col class=\"field-body\" />\n<tbody valign=\"top\">\n<tr class=\"field-odd field\"><th class=\"field-name\">Parameters:</th><td class=\"field-body\"><ul class=\"first simple\">\n<li><strong>image</strong> (<em>ndarray</em>) \u2013 Image data as numpy array in grayscale</li>\n<li><strong>blur</strong> (<em>int</em>) \u2013 Blur image with a filter of blur kernel size</li>\n<li><strong>sobel</strong><strong>(</strong><strong>optional</strong><strong>)</strong> (<em>int</em>) \u2013 Kernel size of the applied sobel operators</li>\n</ul>\n</td>\n</tr>\n<tr class=\"field-even field\"><th class=\"field-name\">Returns:</th><td class=\"field-body\"><p class=\"first\"><strong>gradient_image</strong> \u2013 ndarray of the pixel orientation in a box of \u201csobel\u201d size (unit = rad)</p>\n</td>\n</tr>\n<tr class=\"field-odd field\"><th class=\"field-name\">Return type:</th><td class=\"field-body\"><p class=\"first last\">ndarray</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p class=\"rubric\">Example</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">image</span> <span class=\"o\">=</span> <span class=\"n\">cv2</span><span class=\"o\">.</span><span class=\"n\">imread</span><span class=\"p\">(</span><span class=\"s2\">&quot;path_to_file.png&quot;</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">gradient_image</span> <span class=\"o\">=</span> <span class=\"n\">create_gradient_image</span><span class=\"p\">(</span><span class=\"n\">image</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n</dd></dl>\n\n<dl class=\"attribute\">\n<dt id=\"controllers.utility.get_candidates_accelerated\">\n<code class=\"descclassname\">controllers.utility.</code><code class=\"descname\">get_candidates_accelerated</code><a class=\"reference internal\" href=\"../_modules/controllers/utility/#get_candidates_accelerated\"><span class=\"viewcode-link\">[source]</span></a><a class=\"headerlink\" href=\"#controllers.utility.get_candidates_accelerated\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Numba accelerated code (precompiles to C++) to calculate possible candidates for line profiling.\nI.e. The values of maximal distance for closed holes in the image.\nShould correspond to the maximum width of the SNC</p>\n<table class=\"docutils field-list\" frame=\"void\" rules=\"none\">\n<col class=\"field-name\" />\n<col class=\"field-body\" />\n<tbody valign=\"top\">\n<tr class=\"field-odd field\"><th class=\"field-name\">Parameters:</th><td class=\"field-body\"><ul class=\"first last simple\">\n<li><strong>maximum</strong> (<em>float</em>) \u2013 Max value of dis_tranform</li>\n<li><strong>dis_transform</strong> (<em>ndarray</em>) \u2013 Distance transformed floodfill image. Gives the distance of an inclosed pixel to the next edge</li>\n<li><strong>image_canny</strong> (<em>ndarray</em>) \u2013 Canny processed image</li>\n<li><strong>canny_candidates</strong> (<em>ndarray</em>) \u2013 Empty array with size image_canny.shape</li>\n<li><strong>threshold</strong> (<em>float</em>) \u2013 Threshold for a distance value to be accepted as a candidate</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n</dd></dl>\n\n<dl class=\"function\">\n<dt id=\"controllers.utility.order_points_to_line\">\n<code class=\"descclassname\">controllers.utility.</code><code class=\"descname\">order_points_to_line</code><span class=\"sig-paren\">(</span><em>points</em><span class=\"sig-paren\">)</span><a class=\"reference internal\" href=\"../_modules/controllers/utility/#order_points_to_line\"><span class=\"viewcode-link\">[source]</span></a><a class=\"headerlink\" href=\"#controllers.utility.order_points_to_line\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Determine the two nearest neighbors of each input point. Write the connectivity in a sparse matrix.\nDetermine the order of the points.</p>\n<table class=\"docutils field-list\" frame=\"void\" rules=\"none\">\n<col class=\"field-name\" />\n<col class=\"field-body\" />\n<tbody valign=\"top\">\n<tr class=\"field-odd field\"><th class=\"field-name\">Parameters:</th><td class=\"field-body\"><strong>points</strong> (<em>ndarray</em>) \u2013 Sort input points (nx2) to a line</td>\n</tr>\n<tr class=\"field-even field\"><th class=\"field-name\">Returns:</th><td class=\"field-body\"><strong>points</strong> \u2013 Sorted output points</td>\n</tr>\n<tr class=\"field-odd field\"><th class=\"field-name\">Return type:</th><td class=\"field-body\">ndarray</td>\n</tr>\n</tbody>\n</table>\n</dd></dl>\n\n</div>\n", "metatags": "", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"], ["controllers.fitter", "Fitter package", "N", "next"], ["index", "Welcome to line profiler\u2019s documentation!", "P", "previous"]], "sourcename": "controllers.utility.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Utility package</a></li>\n</ul>\n", "display_toc": false, "page_source_suffix": ".rst", "current_page_name": "controllers.utility", "sidebars": ["relations.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.10"}